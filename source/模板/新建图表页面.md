<% (async () => {
  // ---ã€è‡ªåŠ¨åŒ–ç»ˆæç‰ˆã€‘è‡ªåŠ¨ä¿®æ­£é¢œè‰² + GitHub Actions é€‚é… ---
  
  // 1. è·å–å‰ªè´´æ¿
  let htmlContent = await tp.system.clipboard();
  
  // 2. å»ºè®®åç§°é€»è¾‘
  let suggestion = "new-chart";
  if (tp.file && tp.file.title) {
      suggestion = tp.file.title.replace(/\s+/g, "-").toLowerCase();
  }
  
  // 3. å¼¹çª—è¯¢é—®
  const folderName = await tp.system.prompt("è¯·è¾“å…¥å›¾è¡¨æ–‡ä»¶å¤¹åç§° (è‹±æ–‡ID)", suggestion);
  
  if (folderName) {
      const targetFolder = `source/charts/${folderName}`;
      const targetFilePath = `${targetFolder}/index.html`;
      const vault = app.vault;

      if (!htmlContent || htmlContent.trim() === "") {
          new Notice("âŒ å‰ªè´´æ¿ä¸ºç©ºï¼");
      } else {
          
          // ==========================================
          // ğŸ¤– è‡ªåŠ¨åŒ–æ³¨å…¥ï¼šå¼ºåˆ¶èƒŒæ™¯æ·±è‰²ã€æ–‡å­—ç™½è‰²
          // æ— è®ºæºä»£ç æ€ä¹ˆå†™ï¼Œè¿™é‡Œå¼ºåˆ¶ç»™å®ƒâ€œç©¿ä¸Šâ€ç™½è‰²å­—ä½“æ ·å¼
          // ==========================================
          const autoStyle = `
          <style>
            /* è„šæœ¬è‡ªåŠ¨æ³¨å…¥çš„å¼ºåˆ¶æ ·å¼ */
            body, h1, h2, h3, h4, p, li, span { color: #ffffff !important; }
            body { background-color: #1a1a1a; } /* é˜²æ­¢èƒŒæ™¯å¤ªäº®çœ‹ä¸æ¸…ç™½å­— */
          </style>
          </head>
          `;
          
          // æŠŠæ ·å¼æ’å…¥åˆ° </head> ä¹‹å‰ï¼Œç¡®ä¿ç”Ÿæ•ˆ
          if (htmlContent.includes("</head>")) {
              htmlContent = htmlContent.replace("</head>", autoStyle);
          } else {
              // å¦‚æœæ‰¾ä¸åˆ° head æ ‡ç­¾ï¼Œå°±åŠ åœ¨æœ€å‰é¢
              htmlContent = autoStyle + htmlContent;
          }
          // ==========================================

          // 4. åˆ›å»ºæ–‡ä»¶å¤¹ (Obsidian API)
          if (!vault.getAbstractFileByPath(targetFolder)) {
              await vault.createFolder(targetFolder);
          }

          const existingFile = vault.getAbstractFileByPath(targetFilePath);
          
          if (existingFile) {
              const confirm = await tp.system.prompt(`âš ï¸ ${folderName} å·²å­˜åœ¨ï¼Œè¦†ç›–å—ï¼Ÿ(yes/no)`);
              if (confirm === 'yes') {
                  await vault.modify(existingFile, htmlContent);
                  new Notice(`âœ… å·²æ›´æ–°å¹¶è‡ªåŠ¨ä¿®å¤é¢œè‰²: ${folderName}`);
              }
          } else {
              try {
                  await vault.create(targetFilePath, htmlContent);
                  new Notice(`ğŸ‰ åˆ›å»ºæˆåŠŸ (å·²è‡ªåŠ¨ä¿®å¤é¢œè‰²): ${folderName}`);
              } catch (e) {
                  new Notice(`âŒ å¤±è´¥: ${e.message}`);
                  console.error(e);
              }
          }
      }
  }
  return "";
})() %>